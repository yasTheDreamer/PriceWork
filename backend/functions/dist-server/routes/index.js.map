{"version":3,"sources":["../../../server/routes/index.js"],"names":["router","express","Router","get","req","res","next","userService","UserServiceImpl","factors","query","getAllData","post","service","console","log","session","user","token","recordExists","record","getRecord","then","r","rec","JSON","stringify","parse","address","key","updateRecord","status","send","salary","saveUser","module","exports"],"mappings":"aAAA;;AAEA;AACA,uD,gGAFA;;;;;AAOA,IAAIA,MAAM,GAAGC,oBAAQC,MAAR,EAAb;;AAEA;AACAF,MAAM,CAACG,GAAP,CAAW,UAAX,EAAuB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzC,MAAMC,WAAW,GAAG,IAAIC,2BAAJ,EAApB;AACA,MAAMC,OAAO,GAAGL,GAAG,CAACM,KAAJ,CAAUD,OAA1B;AACAF,EAAAA,WAAW,CAACI,UAAZ,CAAuBN,GAAvB,EAA4BI,OAA5B;AACD,CAJD;;AAMAT,MAAM,CAACY,IAAP,CAAY,OAAZ,EAAqB,UAACR,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvC,MAAIO,OAAO,GAAG,IAAIL,2BAAJ,EAAd;;AAEAM,EAAAA,OAAO,CAACC,GAAR,CAAYX,GAAG,CAACY,OAAhB;AACA,MAAIC,IAAI,GAAG,kCAAcb,GAAd,CAAX;;AAEA;AACEA,EAAAA,GAAG,CAACY,OAAJ;AACAZ,EAAAA,GAAG,CAACY,OAAJ,CAAYE,KADZ;AAEAL,EAAAA,OAAO,CAACM,YAAR,CAAqBf,GAAG,CAACY,OAAJ,CAAYE,KAAjC,CAHF;AAIE;AACA,QAAIE,MAAM,GAAGP,OAAO,CAACQ,SAAR,CAAkBjB,GAAG,CAACY,OAAJ,CAAYE,KAA9B,CAAb;AACAE,IAAAA,MAAM,CAACE,IAAP,CAAY,UAACC,CAAD,EAAO;AACjB,UAAIC,GAAG,GAAGC,IAAI,CAACC,SAAL,CAAe,+BAAWH,CAAX,CAAf,CAAV;AACA,UAAIC,GAAJ,EAAS;AACPA,QAAAA,GAAG,GAAGC,IAAI,CAACE,KAAL,CAAWH,GAAX,CAAN;AACA,YAAI,CAACA,GAAG,CAACI,OAAT,EAAkB;AAChBJ,UAAAA,GAAG,CAACI,OAAJ,GAAc,EAAd;AACD;AACDH,QAAAA,IAAI,CAACC,SAAL,CAAeF,GAAf;AACAP,QAAAA,IAAI,GAAG,kCAAcb,GAAd,EAAmBoB,GAAnB,CAAP;AACA,YAAIK,GAAG,GAAGhB,OAAO,CAACiB,YAAR,CAAqB1B,GAAG,CAACY,OAAJ,CAAYE,KAAjC,EAAwCD,IAAxC,CAAV;AACA,YAAIY,GAAJ,EAASxB,GAAG,CAAC0B,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,cAArB,EAAT;AACK3B,QAAAA,GAAG,CAAC0B,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,iCAAiCH,GAAtD;AACN;AACF,KAbD;AAcD,GApBD,MAoBO,IAAIzB,GAAG,CAACY,OAAJ,IAAe,CAACZ,GAAG,CAACY,OAAJ,CAAYE,KAA5B,IAAqCD,IAAI,CAACgB,MAA9C,EAAsD;AAC3D,QAAIJ,GAAG,GAAGhB,OAAO,CAACqB,QAAR,CAAiBjB,IAAjB,CAAV;AACA,2CAAmBY,GAAnB,EAAwBzB,GAAxB,EAA6BC,GAA7B;AACD,GAHM,MAGA;AACLA,IAAAA,GAAG,CAAC0B,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,yBAArB;AACD;AACF,CAhCD;;AAkCAG,MAAM,CAACC,OAAP,GAAiBpC,MAAjB","sourcesContent":["import express from \"express\";\r\n//testing the firebase database insert\r\nimport UserServiceImpl from \"../services/UserServiceImpl\";\r\nimport {\r\n  constructUser,\r\n  updateSessionToken,\r\n  setListing,\r\n} from \"../utils/utilFunctions\";\r\nvar router = express.Router();\r\n\r\n/* GET home page. */\r\nrouter.get(\"/findAll\", (req, res, next) => {\r\n  const userService = new UserServiceImpl();\r\n  const factors = req.query.factors;\r\n  userService.getAllData(res, factors);\r\n});\r\n\r\nrouter.post(\"/save\", (req, res, next) => {\r\n  let service = new UserServiceImpl();\r\n\r\n  console.log(req.session);\r\n  let user = constructUser(req);\r\n\r\n  if (\r\n    req.session &&\r\n    req.session.token &&\r\n    service.recordExists(req.session.token)\r\n  ) {\r\n    let record = service.getRecord(req.session.token);\r\n    record.then((r) => {\r\n      let rec = JSON.stringify(setListing(r));\r\n      if (rec) {\r\n        rec = JSON.parse(rec);\r\n        if (!rec.address) {\r\n          rec.address = {};\r\n        }\r\n        JSON.stringify(rec);\r\n        user = constructUser(req, rec);\r\n        let key = service.updateRecord(req.session.token, user);\r\n        if (key) res.status(200).send(\"data updated\");\r\n        else res.status(500).send(\"error updating the document \" + key);\r\n      }\r\n    });\r\n  } else if (req.session && !req.session.token && user.salary) {\r\n    let key = service.saveUser(user);\r\n    updateSessionToken(key, req, res);\r\n  } else {\r\n    res.status(500).send(\"data could not be saved\");\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"index.js"}